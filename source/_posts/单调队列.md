---
title: "单调队列学习笔记"
categories:
  - 算法笔记
date: 2017-04-21 20:40:07
tags: [单调队列]
---

# 概述

* 队列是一种$FIFO$的数据结构, 这种结构适合维护序列问题.
* 一般来说, 单调队列都要取维护元素的位置和权值.
* 单调队列中的元素的权值满足单调性.



# 单调队列解决滑动窗口问题.

首先看这样一个例题.

---



例1[^1]

* 给定$n$个元素的数列$a_i$.
* $m$个询问, 每个询问形如$l_i, r_i$, 你需要回答$\min_{i=l_i}^{r_i}$, **不**强制在线.
* $n \leqslant 10000000, m \leqslant 100000$.


考察这样的算法:

1. 排序询问, 左端点为第一关键字, 右端点为第二关键字.
2. 建立单调增队列维护序列最小值.
3. 对于每一个右端点, 首先维护单调性.
4. 然后从左边出队列, 以维护询问.

![](http://i2.muimg.com/567571/cb922387ce8514ab.png)

上面的算法用到了这个问题的两个性质:

1. 可以使用离线算法, 我们就可以排序询问后枚举右端点, 然后弹出左端点以维护询问, 这样就是一个类似滑动窗口的过程.
2. 右端点单调递增伴随着左端点单调递增.

从上面的例题中, 我们知道了单调队列在滑动窗口中的作用: 维护最小值.

---



考察一般情况.

滑动窗口问题指的是这样的一类问题.

1. 第一类问题是给定一个序列, 求一个满足XX性质的最长子序列.
2. 第二类问题是给定一个序列和一系列询问, 求出每个询问的最大值/最小值.

朴素的算法解决滑动窗口问题通常是$\mathcal{O}(n^3)$甚至更高的, 我们可以利用问题的特殊性质使用单调队列优化.

---

**定义**:

右端点为$i$, 满足条件的左端点集合为$f(i)$, 左端点$k$是否满足记作$g_i(k)$.

**性质1**:

对于$\forall i < j$, $f(j) \subset f(i)$.

**性质2**:

对于确定的右端点$i$, $g_i(k)$是单调递增的.

---

上面的性质可以简单的理解为:

**推论1**:

当右端点递增时, 左端点也递增.

对于这种滑动窗口问题, 我们可以设计出这样的算法.

---

**算法1**:

1. 维护左端点指针left, 单调队列q, 枚举右端点.
2. 首先维护单调性(队尾)并把新的点插入.
3. 然后根据单调队列检查性质, 如果不满足性质就右移left指针, 同时在队首弹出位置在left之前的元素.
4. 可以知道这时的left就是右端点对应的最优左端点.

---

我们看一个例题.

---

例二[^2]

* 给定一个长度为$n$的序列
* 求出一个最长的子序列, 满足$\max - \min \leqslant m$.

看到有$\max$, 有$\min$, 还是这种子序列, 很容易想到滑动窗口问题, 然后这里我们需要的是维护最大值和最小值, 所以维护两个单调队列就好了.

---



# 单调队列在动态规划中的应用(斜率优化)

* 维护一个上凸包/下凸包, $m$个递增的询问, 找到与给定斜率最接近的点.
* 单调队列的单调性维护凸包, 每次从队首维护斜率就好了.
* 具体的应用可以看博客里的题目[^3]

[^1]: 经典问题
[^2]: [bzoj2500](http://www.lydsy.com/JudgeOnline/problem.php?id=2500)
[^3]: [konjac的博客](http://gengchen.tech/tags/斜率优化/)

